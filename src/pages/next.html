<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>셀프 체크인</title>
  <link rel="stylesheet" href="../css/next.css">
</head>
<body>
  <div class="step-indicator">
    <div class="step" id="step-indicator-1">1</div>
    <div class="step" id="step-indicator-2">2</div>
    <div class="step" id="step-indicator-3">3</div>
    <div class="step" id="step-indicator-4">4</div>
  </div>
  <div class="step-content" id="step-content">
    <!-- 단계별 내용이 여기에 표시됩니다 -->
  </div>
  <div class="button-group">
    <button class="btn btn-exit" id="exitOrPrevBtn">나가기</button>
    <button class="btn btn-next" id="nextBtn">다음단계</button>
  </div>
  <script>
    let step = 1;
    let flight = '';
    let passenger = '';
    let seat = '';
    const countries = [
      { code: 'KR', name: '한국', flag: '../imgs/kr.png' },
      { code: 'CN', name: '중국', flag: '../imgs/cn.png' },
      { code: 'JP', name: '일본', flag: '../imgs/jp.png' },
      { code: 'US', name: '미국', flag: '../imgs/us.png' }
    ];
    const defaultUsers = [
      { name: '지니썜' }
    ];

    function renderStep() {
      // 단계 표시
      for (let i = 1; i <= 4; i++) {
        document.getElementById('step-indicator-' + i).classList.toggle('active', i === step);
      }
      // 버튼 텍스트 및 동작
      const exitOrPrevBtn = document.getElementById('exitOrPrevBtn');
      const nextBtn = document.getElementById('nextBtn');
      if (step === 1) {
        exitOrPrevBtn.textContent = '나가기';
        exitOrPrevBtn.onclick = () => window.location.href = '../airport_checkin.html';
      } else {
        exitOrPrevBtn.textContent = '이전단계';
        exitOrPrevBtn.onclick = () => {
          if (step > 1) {
            step--;
            renderStep();
          }
        };
      }
      // 단계별 내용
      const content = document.getElementById('step-content');
      if (step === 1) {
        let listHtml = '<div class="flight-list">';
        for (let c of countries) {
          listHtml += `<div class="flight-item${flight === c.code ? ' selected' : ''}" data-code="${c.code}">
            <span style='display:flex;align-items:center;gap:12px;'>
              <img src="${c.flag}" alt="${c.name} 국기" style="width:32px;height:22px;border-radius:4px;border:1px solid #bbb;box-shadow:0 1px 2px #eee;"> ${c.name}
            </span>
          </div>`;
        }
        listHtml += '</div>';
        content.innerHTML = `
          <h2>1단계: 나라 선택</h2>
          ${listHtml}
        `;
        // 선택 이벤트
        document.querySelectorAll('.flight-item').forEach(el => {
          el.addEventListener('click', function() {
            document.querySelectorAll('.flight-item').forEach(f => f.classList.remove('selected'));
            this.classList.add('selected');
            flight = this.dataset.code;
            nextBtn.disabled = false;
          });
        });
        nextBtn.disabled = !flight;
      } else if (step === 2) {
        let userList = [];
        const savedList = JSON.parse(localStorage.getItem('passengerList') || '[]');
        if (Array.isArray(savedList) && savedList.length > 0) {
          userList = savedList.map(n => ({ name: n }));
        } else {
          userList = [...defaultUsers];
        }
        let userHtml = '<div class="user-list">';
        for (let u of userList) {
          userHtml += `<div class="user-item${passenger === u.name ? ' selected' : ''}" data-name="${u.name}">
            <span>${u.name}</span>
          </div>`;
        }
        userHtml += '</div>';
        content.innerHTML = `
          <h2>2단계: 탑승객 선택</h2>
          ${userHtml}
        `;
        document.querySelectorAll('.user-item').forEach(el => {
          el.addEventListener('click', function() {
            document.querySelectorAll('.user-item').forEach(f => f.classList.remove('selected'));
            this.classList.add('selected');
            passenger = this.dataset.name;
            nextBtn.disabled = false;
          });
        });
        nextBtn.disabled = !passenger;
      } else if (step === 3) {
        // 비행기 좌석 배치 (3-4-3, 3줄 예시)
        let seatMap = [
          ['1A','1B','1C',null,'1D','1E','1F','1G'],
          ['2A','2B','2C',null,'2D','2E','2F','2G'],
          ['3A','3B','3C',null,'3D','3E','3F','3G']
        ];
        let seatGrid = '<div class="airplane-seats">';
        for (let row of seatMap) {
          seatGrid += '<div class="seat-row">';
          for (let s of row) {
            if (s === null) {
              seatGrid += '<span class="aisle"></span>';
            } else {
              seatGrid += `<div class="seat" data-seat="${s}">${s}</div>`;
            }
          }
          seatGrid += '</div>';
        }
        seatGrid += '</div>';
        content.innerHTML = `
          <h2>3단계: 좌석 선택</h2>
          ${seatGrid}
        `;
        nextBtn.disabled = true;
        // 좌석 선택 이벤트
        document.querySelectorAll('.seat').forEach(el => {
          el.addEventListener('click', function() {
            document.querySelectorAll('.seat').forEach(s => s.classList.remove('selected'));
            this.classList.add('selected');
            seat = this.dataset.seat;
            nextBtn.disabled = false;
          });
        });
      } else if (step === 4) {
        content.innerHTML = `
          <h2>4단계: 탑승권 발권</h2>
          <div class="ticket">
            <div>항공편: <b>${flight || 'N/A'}</b></div>
            <div>탑승객: <b>${passenger || 'N/A'}</b></div>
            <div>좌석번호: <b>${seat || 'N/A'}</b></div>
            <div style="margin-top:12px; color:#1976d2; font-weight:bold;">탑승권이 발급되었습니다!</div>
          </div>
          <div id="plane-anim-bg" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999;background:rgba(227,242,253,0.95);justify-content:center;align-items:center;">
            <div style="width:220px;height:120px;position:relative;overflow:visible;">
              <img id="plane-img" src="../imgs/plane.png" alt="비행기" style="position:absolute;left:0;top:30px;width:120px;height:60px;" />
            </div>
            <div style="margin-top:60px;font-size:1.2em;color:#1976d2;font-weight:bold;">비행기가 출발합니다!</div>
          </div>
        `;
        nextBtn.disabled = false;
        nextBtn.textContent = '완료';
        nextBtn.onclick = () => {
          // 비행기 애니메이션 보여주기
          const animBg = document.getElementById('plane-anim-bg');
          animBg.style.display = 'flex';
          const plane = document.getElementById('plane-img');
          plane.style.transition = 'transform 2s cubic-bezier(0.4,1,0.7,1)';
          plane.style.transform = 'translateX(0)';
          setTimeout(() => {
            plane.style.transform = 'translateX(120px) translateY(-60px) scale(1.2) rotate(-10deg)';
          }, 50);
          setTimeout(() => {
            window.location.href = '../airport_checkin.html';
          }, 2050);
        };
        return;
      }
      // 버튼 텍스트
      nextBtn.textContent = (step < 4) ? '다음단계' : '완료';
      nextBtn.onclick = nextBtnHandler;
    }
    function nextBtnHandler() {
      if (step === 1) {
        if (!flight) { alert('항공편을 선택하세요.'); return; }
        step++;
        renderStep();
      } else if (step === 2) {
        if (!passenger) { alert('탑승객을 선택하세요.'); return; }
        step++;
        renderStep();
      } else if (step === 3) {
        if (!seat) { alert('좌석을 선택하세요.'); return; }
        step++;
        renderStep();
      }
    }
    renderStep();
  </script>
</body>
</html> 